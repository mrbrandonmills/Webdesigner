╔══════════════════════════════════════════════════════════════════════════════╗
║                   INSTAGRAM IMAGE PREPROCESSING SYSTEM                        ║
║                          Aspect Ratio Fix Flow                                ║
╚══════════════════════════════════════════════════════════════════════════════╝

┌─────────────────────────────────────────────────────────────────────────────┐
│  1. USER CALLS api.post(imageUrl, caption)                                  │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│  2. DOWNLOAD & CHECK IMAGE                                                   │
│     • Download from URL                                                      │
│     • Get dimensions (width × height)                                        │
│     • Calculate aspect ratio                                                 │
│     • Check: 0.8 ≤ ratio ≤ 1.91 ?                                           │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                    ┌───────────────┴───────────────┐
                    ▼                               ▼
        ┌───────────────────────┐      ┌────────────────────────┐
        │  VALID RATIO ✅       │      │  INVALID RATIO ⚠️       │
        │  (0.8 to 1.91)        │      │  (< 0.8 or > 1.91)     │
        └───────────────────────┘      └────────────────────────┘
                    │                               │
                    │                               ▼
                    │              ┌─────────────────────────────────┐
                    │              │  3. DETERMINE TARGET RATIO       │
                    │              │     • Too wide (>1.91) → 1.91:1 │
                    │              │     • Too tall (<0.8) → 0.8:1   │
                    │              └─────────────────────────────────┘
                    │                               │
                    │                               ▼
                    │              ┌─────────────────────────────────┐
                    │              │  4. PROCESS IMAGE               │
                    │              │                                 │
                    │              │  Method A: CROP (default)       │
                    │              │  ┌─────────────────────────┐   │
                    │              │  │ Remove edges from center │   │
                    │              │  │ Example: 2000×935 →     │   │
                    │              │  │          1786×935       │   │
                    │              │  └─────────────────────────┘   │
                    │              │                                 │
                    │              │  Method B: PAD                  │
                    │              │  ┌─────────────────────────┐   │
                    │              │  │ Add background padding   │   │
                    │              │  │ Example: 2000×935 →     │   │
                    │              │  │          2000×1047      │   │
                    │              │  └─────────────────────────┘   │
                    │              └─────────────────────────────────┘
                    │                               │
                    │                               ▼
                    │              ┌─────────────────────────────────┐
                    │              │  5. UPLOAD TO CDN               │
                    │              │     • Try Vercel Blob first     │
                    │              │     • Fallback to Cloudinary    │
                    │              │     • Get public URL            │
                    │              └─────────────────────────────────┘
                    │                               │
                    └───────────────┬───────────────┘
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│  6. POST TO INSTAGRAM                                                        │
│     • Use final URL (original or CDN)                                       │
│     • Create media container                                                │
│     • Wait random delay (3-15 min)                                          │
│     • Publish media                                                         │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│  7. SUCCESS ✅                                                               │
│     • Post is live on Instagram                                             │
│     • Analytics tracked                                                     │
│     • Engagement monitoring started                                         │
└─────────────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════
                             EXAMPLE: MUG IMAGE
═══════════════════════════════════════════════════════════════════════════════

Original Image
┌────────────────────────────────────────────────────────┐
│                                                        │  ← 2000px wide
│                    MUG IMAGE                           │
│                                                        │  ← 935px tall
└────────────────────────────────────────────────────────┘
Aspect Ratio: 2.14:1 ⚠️  TOO WIDE!

After Processing (Crop Method)
┌──────────────────────────────────────────────────┐
│                                                  │  ← 1786px wide
│                 MUG IMAGE                        │
│                                                  │  ← 935px tall
└──────────────────────────────────────────────────┘
Aspect Ratio: 1.91:1 ✅ VALID!
Lost: 214px from sides (107px each side)

After Processing (Pad Method)
┌────────────────────────────────────────────────────────┐
│                    (white space)                       │  ← Padding (56px)
├────────────────────────────────────────────────────────┤
│                                                        │  ← 2000px wide
│                    MUG IMAGE                           │
│                                                        │  ← 935px tall
├────────────────────────────────────────────────────────┤
│                    (white space)                       │  ← Padding (56px)
└────────────────────────────────────────────────────────┘
Total Height: 1047px
Aspect Ratio: 1.91:1 ✅ VALID!


═══════════════════════════════════════════════════════════════════════════════
                          PERFORMANCE & OVERHEAD
═══════════════════════════════════════════════════════════════════════════════

Valid Images (0.8:1 to 1.91:1)
├─ Overhead: 0ms (no processing)
└─ Flow: Check → Post directly

Invalid Images (outside range)
├─ Download:    ~100-300ms
├─ Processing:  ~50-200ms
├─ Upload:      ~200-500ms
└─ Total:       ~350-1000ms overhead


═══════════════════════════════════════════════════════════════════════════════
                          INSTAGRAM ASPECT RATIOS
═══════════════════════════════════════════════════════════════════════════════

┌──────────────┬──────────┬─────────┬───────────────────────────────┐
│ Type         │ Ratio    │ Decimal │ Notes                         │
├──────────────┼──────────┼─────────┼───────────────────────────────┤
│ Max Portrait │ 4:5      │ 0.8     │ Tallest allowed              │
│ Square       │ 1:1      │ 1.0     │ Classic Instagram            │
│ Landscape    │ 16:9     │ 1.78    │ Common for photos            │
│ Max Landscp  │ 1.91:1   │ 1.91    │ Widest allowed               │
└──────────────┴──────────┴─────────┴───────────────────────────────┘

System Tolerance: ±0.01 for floating-point precision


═══════════════════════════════════════════════════════════════════════════════
                            READY FOR PRODUCTION ✅
═══════════════════════════════════════════════════════════════════════════════
